services:
  bandersnatch:
    image: pypa/bandersnatch:latest
    volumes:
      # Mount the bandersnatch configuration file at default location
      - "./config/bandersnatch.conf:/etc/bandersnatch.conf"
      # Mirror data will go here
      - "./data:/srv/pypi"
      # Mount requirements generated by pip-compile for bandersnatch to mirror
      - "./requirements:/requirements"
    # Mirror mode mirrors all the packages in the mirror list of the config file
    command: bandersnatch mirror
    networks:
      - bandersnatch_net

  nginx:
    image: nginx:latest
    volumes:
      # Mount custom nginx.conf at default location
      - "./config/nginx.conf:/etc/nginx/nginx.conf:ro"
      # Bandersnatch mirror data (maps to port 4000)
      - "./data:/data/pypi:ro"
      # Requirements data (maps to port 5000)
      - "./requirements:/requirements:ro"
    ports:
      - "4000:80"
      - "5000:90"
    networks:
      - bandersnatch_net

networks:
  bandersnatch_net:
    driver: bridge
    driver_opts:
      com.docker.network.driver.mtu: 1500
