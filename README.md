# PyPI Mirror: Bandersnatch w/ Docker Compose & nginx

Simple setup to run a PyPI mirror using Bandersnatch w/ Docker Compose & nginx.

## Setup

1. Clone this repository:

   ```sh
   git clone https://github.com/sean-donoghue/pypi-mirror.git
   ```

2. Place pip requirements file(s) in the `requirements` directory (ensure files have the
   `.in` extension, `.txt` files are generated by the next step)
3. Run the `compile_requirements.py` script to generate pinned requirements files via
   [pip-compile](https://github.com/jazzband/pip-tools/):

   ```sh
   # Output from pip-compile can vary between environments and Python versions;
   # Run the script in a Python 3.11 container to ensure consistent results
   docker run -it --rm -v "$PWD":/app -w /app python:3.11-alpine \
       sh -c "pip install pip-tools && python compile_requirements.py"

   # Or run it directly if you still want to and have Python 3.11 installed
   pip3.11 install --user pip-tools && python3.11 compile_requirements.py
   ```

4. Start the Docker Compose stack:

   ```sh
   docker-compose up -d
   ```

5. Wait for the Bandersnatch container to sync packages and exit:

   ```sh
   docker-compose logs -f bandersnatch
   ```

Your mirror should now be available at: `http://localhost:4000/simple/`  
Your requirements files should also be served at: `http://localhost:5000/`

## Usage

To use the mirror instead of PyPI, use the `--index-url` or `-i` option with pip:

```sh
pip install requests --index http://localhost:4000/simple/
```

You can also directly use the mirror for requirements files:

```sh
pip install -r http://localhost:5000/requirements-example.txt -i http://localhost:4000/simple/
```

If you left the example requirements files in the `requirements` directory, the above
commands should work as-is.
